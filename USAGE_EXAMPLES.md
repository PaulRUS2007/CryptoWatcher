# –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CryptoWatcher

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd CryptoWatcher

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
echo "TELEGRAM_API_KEY=your_bot_token_here" > .env
echo "LOG_LEVEL=INFO" >> .env

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
python bot.py
```

### 2. –ü–µ—Ä–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram –ø–æ –∏–º–µ–Ω–∏
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–º–∞–Ω–¥

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

#### /start
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: /start
–ë–æ—Ç: –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å! –í—ã–±–µ—Ä–∏—Ç–µ, —á—Ç–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–¥–µ–ª–∞—Ç—å:
     [–¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã] [–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏] [–ù–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞]
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö —Ü–µ–Ω
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã
–ë–æ—Ç: –¢–µ–∫—É—â–∏–µ —Ü–µ–Ω—ã:
     üëç BITCOIN:
     –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ - $45,230.50
     –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞ = +2.34%
     –ú–∏–Ω–∏–º—É–º –∑–∞ 24 —á–∞—Å–∞ = $44,100.00
     –ú–∞–∫—Å–∏–º—É–º –∑–∞ 24 —á–∞—Å–∞ = $45,500.00
     
     üëé ETHEREUM:
     –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ - $3,200.75
     –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞ 24 —á–∞—Å–∞ = -1.25%
     –ú–∏–Ω–∏–º—É–º –∑–∞ 24 —á–∞—Å–∞ = $3,150.00
     –ú–∞–∫—Å–∏–º—É–º –∑–∞ 24 —á–∞—Å–∞ = $3,300.00
```

#### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–¥–ø–∏—Å–æ–∫
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏
–ë–æ—Ç: –¢–≤–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏:
     BITCOIN, —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –ø–æ—Ä–æ–≥ 5%, –∏–Ω—Ç–µ—Ä–≤–∞–ª 1 —á–∞—Å
     ETHEREUM, —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: –ø–æ—Ä–æ–≥ 3%, –∏–Ω—Ç–µ—Ä–≤–∞–ª 2 —á–∞—Å–∞
     [–ò–∑–º–µ–Ω–∏—Ç—å]
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫

#### –ß–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
     [BitCoin] [DogeCoin] [Ethereum] [Other]
     
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [BitCoin]
–ë–æ—Ç: –ü–æ–¥–ø–∏—Å–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!
     –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ bitcoin
```

#### –†—É—á–Ω–æ–π –≤–≤–æ–¥
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: –ù–æ–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞
–ë–æ—Ç: –í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
     [BitCoin] [DogeCoin] [Ethereum] [Other]
     
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [Other]
–ë–æ—Ç: –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: cardano
–ë–æ—Ç: –ü–æ–¥–ø–∏—Å–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞!
     –í—ã –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ cardano
```

#### –ü–æ–∏—Å–∫ –ø–æ—Ö–æ–∂–∏—Ö –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [Other]
–ë–æ—Ç: –í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–æ–Ω–µ—Ç—ã:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: bitcoi
–ë–æ—Ç: –ù–µ—Ç —Ç–∞–∫–æ–π –º–æ–Ω–µ—Ç—ã
     –í–æ–∑–º–æ–∂–Ω–æ –∏–º–µ–ª–æ—Å—å –≤–≤–∏–¥—É:
     [bitcoin] [bitcoin-cash] [bitcoin-gold]
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ò–∑–º–µ–Ω–∏—Ç—å] (–∏–∑ "–ú–æ–∏ –ø–æ–¥–ø–∏—Å–∫–∏")
–ë–æ—Ç: –ö–∞–∫—É—é –ø–æ–¥–ø–∏—Å–∫—É –∏–∑–º–µ–Ω–∏—Ç—å?
     [BITCOIN] [ETHEREUM]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [BITCOIN]
–ë–æ—Ç: –ß—Ç–æ –∏–∑–º–µ–Ω–∏—Ç—å?
     [–ü–æ—Ä–æ–≥ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
     [–¢–∞–π–º–∞—É—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
     [–£–¥–∞–ª–∏—Ç—å bitcoin]

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–ü–æ—Ä–æ–≥ –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
–ë–æ—Ç: –í–≤–µ–¥–∏—Ç–µ –ø–æ—Ä–æ–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–æ—Ç 1 –¥–æ 100):

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: 10
–ë–æ—Ç: –ü–æ—Ä–æ–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –¥–ª—è bitcoin –∏–∑–º–µ–Ω—ë–Ω, –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 10%
```

#### –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: [–£–¥–∞–ª–∏—Ç—å bitcoin]
–ë–æ—Ç: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ bitcoin —É–¥–∞–ª–µ–Ω–∞
```

## –ü—Ä–∏–º–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ —Ä–æ—Å—Ç–µ —Ü–µ–Ω—ã
```
üìà BITCOIN –≤—ã—Ä–æ—Å –Ω–∞ 5.2% –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 2 —á–∞—Å–∞!
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $47,500.00
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –ø–∞–¥–µ–Ω–∏–∏ —Ü–µ–Ω—ã
```
üìâ ETHEREUM —É–ø–∞–ª –Ω–∞ 3.8% –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 45 –º–∏–Ω—É—Ç!
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $3,100.25
```

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
```
üìà CARDANO –≤—ã—Ä–æ—Å –Ω–∞ 7.5% –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 —á–∞—Å–∞ 15 –º–∏–Ω—É—Ç!
–¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞: $0.85
```

## –ü—Ä–∏–º–µ—Ä—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –ö–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–ü–æ—Ä–æ–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** 10%
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 6 —á–∞—Å–æ–≤
- **–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã:** Bitcoin, Ethereum

### –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–ü–æ—Ä–æ–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** 2%
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 30 –º–∏–Ω—É—Ç
- **–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –∞–ª—å—Ç–∫–æ–∏–Ω–æ–≤

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è
- **–ü–æ—Ä–æ–≥ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** 20%
- **–ò–Ω—Ç–µ—Ä–≤–∞–ª:** 24 —á–∞—Å–∞
- **–ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã:** –¢–æ–ª—å–∫–æ –∫—Ä—É–ø–Ω—ã–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã

## –ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ Python –∫–æ–¥–µ

```python
import asyncio
from coingecko import fetch_prices, fetch_coins_list
from database import add_user, add_subscription, get_user_subscriptions

async def example_usage():
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω
    prices = await fetch_prices(['bitcoin', 'ethereum'])
    print(f"Bitcoin price: ${prices['bitcoin']['usd']}")
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç
    coins = await fetch_coins_list()
    print(f"Total coins available: {len(coins)}")
    
    # –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
    await add_user(12345)
    await add_subscription(12345, 'bitcoin', alert_threshold=5, interval=3600)
    
    # –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
    subs = await get_user_subscriptions(12345)
    print(f"User subscriptions: {subs}")

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–º–µ—Ä–∞
asyncio.run(example_usage())
```

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API –Ω–∞–ø—Ä—è–º—É—é

```python
import aiohttp
import asyncio

async def direct_api_usage():
    # –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ CoinGecko API
    async with aiohttp.ClientSession() as session:
        async with session.get(
            "https://api.coingecko.com/api/v3/simple/price",
            params={"ids": "bitcoin,ethereum", "vs_currencies": "usd"}
        ) as resp:
            data = await resp.json()
            print(f"API Response: {data}")

asyncio.run(direct_api_usage())
```

## –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### .env —Ñ–∞–π–ª
```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_API_KEY=1234567890:ABCdefGHIjklMNOpqrsTUVwxyz

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
LOG_LEVEL=INFO
DB_FILE=db.sqlite
CLEANUP_INTERVAL=3600
PRICE_CHECK_INTERVAL=60
COINS_UPDATE_INTERVAL=86400
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
```python
import logging

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.DEBUG,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('bot.log'),
        logging.StreamHandler()
    ]
)
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
python -m venv venv
source venv/bin/activate  # Linux/Mac
# –∏–ª–∏
venv\Scripts\activate  # Windows

pip install -r requirements.txt
python bot.py
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```dockerfile
FROM python:3.9-slim

WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt

COPY . .
CMD ["python", "bot.py"]
```

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
docker build -t crypto-watcher .
docker run -d --name crypto-bot \
  -e TELEGRAM_API_KEY=your_token \
  -v $(pwd)/data:/app/data \
  crypto-watcher
```

### Systemd —Å–µ—Ä–≤–∏—Å
```ini
[Unit]
Description=CryptoWatcher Bot
After=network.target

[Service]
Type=simple
User=crypto
WorkingDirectory=/opt/crypto-watcher
ExecStart=/opt/crypto-watcher/venv/bin/python bot.py
Restart=always
Environment=TELEGRAM_API_KEY=your_token

[Install]
WantedBy=multi-user.target
```

## –ü—Ä–∏–º–µ—Ä—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –±–æ—Ç–∞
```python
import aiohttp
import asyncio

async def check_bot_health():
    """–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –±–æ—Ç–∞"""
    try:
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Telegram API
        async with aiohttp.ClientSession() as session:
            async with session.get(
                f"https://api.telegram.org/bot{TELEGRAM_API_KEY}/getMe"
            ) as resp:
                if resp.status == 200:
                    print("‚úÖ Telegram API –¥–æ—Å—Ç—É–ø–µ–Ω")
                else:
                    print("‚ùå Telegram API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
        
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ CoinGecko API
        async with aiohttp.ClientSession() as session:
            async with session.get(
                "https://api.coingecko.com/api/v3/ping"
            ) as resp:
                if resp.status == 200:
                    print("‚úÖ CoinGecko API –¥–æ—Å—Ç—É–ø–µ–Ω")
                else:
                    print("‚ùå CoinGecko API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω")
                    
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: {e}")

asyncio.run(check_bot_health())
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
import time
import logging

def performance_monitor(func):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"""
    async def wrapper(*args, **kwargs):
        start_time = time.time()
        result = await func(*args, **kwargs)
        end_time = time.time()
        
        logging.info(
            f"Function {func.__name__} executed in {end_time - start_time:.2f}s"
        )
        return result
    return wrapper

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
@performance_monitor
async def check_prices(bot):
    # ... –∫–æ–¥ —Ñ—É–Ω–∫—Ü–∏–∏
    pass
```

## –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### Unit —Ç–µ—Å—Ç—ã
```python
import pytest
import asyncio
from unittest.mock import AsyncMock, patch
from handlers import cmd_start
from database import add_user

@pytest.mark.asyncio
async def test_cmd_start_new_user():
    """–¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥—ã /start –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ú–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
    message = AsyncMock()
    message.from_user.id = 12345
    
    # –ú–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    with patch('handlers.get_user', return_value=[]):
        with patch('handlers.add_user', new_callable=AsyncMock):
            await cmd_start(message)
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω
            message.answer.assert_called()
            assert "–í—ã–±–µ—Ä–∏—Ç–µ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã" in str(message.answer.call_args)
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```python
import pytest
from database import init_db, add_user, get_user

@pytest.mark.asyncio
async def test_user_workflow():
    """–¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º"""
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
    await init_db()
    
    # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await add_user(12345)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
    user = await get_user(12345)
    assert len(user) == 1
    assert user[0][0] == 12345
```

## –ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥
```python
from aiogram import Router, types
from aiogram.filters import Command

router = Router()

@router.message(Command("help"))
async def cmd_help(message: types.Message) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∫–æ–º–∞–Ω–¥–∞–º"""
    help_text = """
    –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:
    /start - –ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –±–æ—Ç–æ–º
    /help - –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
    /stats - –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
    """
    await message.answer(help_text)

@router.message(Command("stats"))
async def cmd_stats(message: types.Message) -> None:
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –ë–î
    subs = await get_user_subscriptions(message.from_user.id)
    
    stats_text = f"""
    –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
    ‚Ä¢ –ü–æ–¥–ø–∏—Å–æ–∫: {len(subs)}
    ‚Ä¢ –ê–∫—Ç–∏–≤–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π: {sum(1 for sub in subs if sub[3] > 0)}
    """
    await message.answer(stats_text)
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö
```python
# –ù–æ–≤—ã–π –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥—Ä—É–≥–∏–º API
import aiohttp
from typing import Dict, List

async def fetch_prices_from_binance(tickers: List[str]) -> Dict[str, float]:
    """–ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω —Å Binance API"""
    url = "https://api.binance.com/api/v3/ticker/price"
    
    async with aiohttp.ClientSession() as session:
        prices = {}
        for ticker in tickers:
            async with session.get(url, params={"symbol": f"{ticker.upper()}USDT"}) as resp:
                if resp.status == 200:
                    data = await resp.json()
                    prices[ticker] = float(data["price"])
        return prices
```
